<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="unsorrydotnet">
	<link href="https://unsorry.net/assets-date/images/favicon.png" rel="shortcut icon" type="image/png">
	<title>Pivot Table Example</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<link rel="stylesheet" href="assets/pivot-table-js/pivot.css">
</head>

<body>
	<div class="container my-3">
		<div class="card shadow">
			<div class="card-header">
				<h3><i class="bi bi-file-earmark-spreadsheet-fill"></i> Pivot Table Example</h3>
			</div>
			<div class="card-body">
				<div id="output_pivot">
					<div class="d-flex justify-content-center">
						<button class="btn btn-primary" type="button" disabled="">
							<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
							Processing...
						</button>
					</div>
				</div>
				<button class="btn btn-sm btn-primary mt-2" onclick="exportTableToExcel('pivotTable')" style="display: none;"
					id="btnDownload"><i class="bi bi-file-earmark-arrow-down-fill"></i> Download Table as Excel (xls)</button>
			</div>
			<div class="card-footer">
				<div class="text-center">
					<a href="https://github.com/anshori/pivot-table-js" target="_blank" class="text-decoration-none text-secondary">Source Code</a>
				</div>
			</div>
		</div>
		<div class="text-center mt-2">
			<small><a href="http://unsorry.net" target="_blank" class="text-decoration-none text-secondary">unsorry@2024</a></small>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
		crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="https://code.jquery.com/ui/1.14.0/jquery-ui.min.js"></script>
	<script src="assets/pivot-table-js/pivot.js"></script>
	<script>
		$(document).ready(function () {
			$(function () {
				var derivers = $.pivotUtilities.derivers;
				var renderers = $.extend($.pivotUtilities.renderers,
					$.pivotUtilities.plotly_renderers);

				$.getJSON("data/podes_purbalingga.json", function (pivot) {
					$("#output_pivot").pivotUI(pivot, {
						renderers: renderers,
						cols: ["Sumber Penghasilan Utama"],
						rows: ["Kecamatan"],
						rendererName: "Table",
						rowOrder: "value_a_to_z",
						colOrder: "value_z_to_a",
					});

					$('#loading').hide();

					$('#btnDownload').show();
				});
			});
		});

		function exportTableToExcel(tableID, filename = '') {
			var downloadLink;
			var dataType = 'application/vnd.ms-excel';
			var tableSelect = document.getElementById(tableID);
			var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

			filename = filename ? filename + '.xls' : 'excel_data.xls';
			downloadLink = document.createElement("a");

			document.body.appendChild(downloadLink);

			if (navigator.msSaveOrOpenBlob) {
				var blob = new Blob(['\ufeff', tableHTML], {
					type: dataType
				});
				navigator.msSaveOrOpenBlob(blob, filename);
			} else {

				downloadLink.href = 'data:' + dataType + ', ' + tableHTML;

				downloadLink.download = filename;

				downloadLink.click();
			}
		}
	</script>
</body>

</html>